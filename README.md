# cycleGAN-in-building-garbage-dataset
&nbsp;&nbsp;&nbsp;&nbsp;本项工作是在天津大学曾明教授指导下的大创项目《构建大规模城市生活垃圾流水线多目标检测图像数据集》的一部分内容，在前一部分工作中，我们得到了多个单目标物品拼接而成的多目标图片，但是这些图片存在着明显的“硬拼接”色彩，为使我们得到的数据集更加逼真，项目组拟采用cycleGAN的方法生成一定的阴影和变形。 
  
## cycleGAN原理
#### 1.基本介绍
&nbsp;&nbsp;&nbsp;&nbsp;CycleGAN 是一种无需成对示例便可自动进行图像到图像转换的技术。这些模型是采用一批无需关联的来自源域和目标域的图像，以一种无监督的方式训练的。

&nbsp;&nbsp;&nbsp;&nbsp;这一简单的技术非常强大，在一系列应用领域中取得了令人印象深刻的视觉效果，最著名的便是将马的照片转换成斑马（或相反）——本项工作也是基于这一转换过程的修改(https://github.com/aitorzip/PyTorch-CycleGAN )

&nbsp;&nbsp;&nbsp;&nbsp;GAN 架构是一种训练图像合成模型的方法，它由两个模型组成：发生器模型和判别器模型。生成器将来自潜在空间的一个点作为输入，并从域中生成新的可信图像，判别器将图像作为输入，并预测它是真的（来自数据集）还是假的（生成的）。在游戏中训练这两个模型，这样生成器可以不断更新以更好地 “欺骗” 判别器，判别器也会不断更新以更好地检测生成的图像。

&nbsp;&nbsp;&nbsp;&nbsp;CycleGAN 是 GAN 架构的一个分支，它可以同时进行两个生成器模型和两个判别器模型训练。

&nbsp;&nbsp;&nbsp;&nbsp;一个生成器从第一个域获取图像作为第二个域的输入和输出图像，另一个生成器从第二个域获取图像作为输入图像并从第一个域生成图像。然后使用判别器模型确定生成的图像的合理性，并相应地更新生成器模型。CycleGAN 对架构的扩展之处在于使用了循环一致性。第一个生成器输出的图像可以用作第二个生成器的输入图像，第二个生成器的输出图像应与原始图像匹配。相反地，第二个生成器的输出图像可以作为第一个生成器的输入图像，结果应该与第二个生成器的输入图像相匹配。

&nbsp;&nbsp;&nbsp;&nbsp;CycleGAN 通过增加额外的损耗来测量第二个生成器生成的输出图像与原始图像之间的差异，来强化循环一致性，反之亦然。这是对生成模型的规范化，这引导着新领域中的图像生成过程走向图像转换过程。

#### 2.训练过程

&nbsp;&nbsp;&nbsp;&nbsp;来考虑一下我们在完成从夏天到冬天及从冬天到夏天的图像转换中需要关注的问题。

&nbsp;&nbsp;&nbsp;&nbsp;我们有两组不成对的图像，这意味着它们是在不同时间不同地点的照片；冬季和夏季的图像中没有完全相同的场景。

 - 集合1：夏季景观图像。
 - 集合2：冬季景观图像。

&nbsp;&nbsp;&nbsp;&nbsp;我们将开发一个包含两个 GANs 的架构，每个 GANs 都有一个判别器和一个生成器模型，这意味着架构中总共有四个模型。
第一个 GAN 可以根据夏天的图像生成冬天的图像，第二个 GAN 会根据冬天的图像生成夏天的图像。

 - GAN 1: 把夏季图像（集合1）转换成冬季图像（集合2）。
 - GAN 2: 将冬季图像（集合2）转换成夏季图像（集合1）。

&nbsp;&nbsp;&nbsp;&nbsp;每个 GAN 都有一个有条件的生成器模型，该模型将合成给定的输入图像。每个 GAN 都有一个判别器模型来预测生成的图像来自目标图像集合的可能性。GAN 的判别器和生成器模型就像标准 GAN 模型一样，在正常的对抗损耗下训练。我们可以将 GAN 1 的生成器和判别器模型总结如下：

 - 生成器模型 1:
 - 输入：选取夏季图像 ( 集合1 ).
 - 输出: 生成冬季图像 ( 集合2 ).
 - 判别器模型 1:
 - 输入: 从集合 2 选取冬季图像，从生成器 1 输出。
 - 输出: 图像来自集合 2 的可能性。
 - 同样，我们可以将 GAN2 的生成器和判别器模型总结如下：
 - 生成器模型 2:
 - 输入：选取冬季图像 ( 集合2 ).
 - 输出：生成夏季图像 ( 集合1 ).
 - 判别器模型 2:
 - 输入: 从集合 1 选取夏季图像，从生成器 2 输出。
 - 输出: 图像来自集合 1 的可能性。

到目前为止，这些模型足以在目标域中生成可信的图像，但不能转换输入图像。

&nbsp;&nbsp;&nbsp;&nbsp;每个 GAN 也根据循环一致性损耗进行更新。这是为了强化目标域中由输入图像转换而来的合成图像。

&nbsp;&nbsp;&nbsp;&nbsp;循环一致性损耗将输入照片与 Cycle GAN 的生成照片进行比较，并计算两者之间的差异，例如使用 L1 范数或像素值的绝对差之和。有两种方法计算循环一致性损耗，并用于更新每个训练迭代的生成器模型：

&nbsp;&nbsp;&nbsp;&nbsp;第一个 GAN (GAN 1) 将获取夏季景观的图像，生成冬季景观的图像，该图像作为第二个 GAN (GAN 2) 的输入，又将生成夏季景观的图像。循环一致性损耗计算了 GAN 1 的图像输入和 GAN 2 的图像输出之间的差异，并相应地更新了生成模型，以减少图像中的差异。

&nbsp;&nbsp;&nbsp;&nbsp;这是一个循环一致性损耗的正向循环。同样的过程在生成器 2 到生成器 1 的反向循环一致性损耗时会逆转过来，还会将冬季原始照片与冬季生成照片进行比较。

正向循环一致性损耗：

 - 向 GAN 1 中输入夏季图像（集合 1 ）
 - 从 GAN 1 中输出冬季图像
 - 从 GAN 1 向 GAN 2 输入冬季图像
 - 从 GAN 2 中输出夏季图像
 - 将夏季图像（集合 1 ）与 GAN 2 中的夏季图像作对比
 - 反向循环一致性损耗：
 - 向 GAN 2 中输入冬季图像（集合 2 ）
 - 从 GAN 2 中输出夏季图像
 - 从 GAN 2 向 GAN 1 输入夏季图像
 - 从 GAN 1中输出冬季图像
 - 将冬季图像（集合 2 ）与 GAN 1 中的冬季图像作对比


